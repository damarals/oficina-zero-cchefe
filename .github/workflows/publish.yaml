name: Quarto Publish

on:
  workflow_dispatch:
  push:
    branches: [main]

jobs:

  build-and-convert:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4

    - name: Set up Quarto
      uses: quarto-dev/quarto-actions/setup@v2
      with:
        tinytex: true

    - name: Render and Convert Quarto Documents
      run: |
        for file in `find . -name "*.qmd"`; do
          quarto render "$file"
          base_name=$(basename "$file" .qmd)
          docker run --rm -t -v ${{ github.workspace }}:/slides astefanutti/decktape "$base_name.html" "$base_name.pdf"
          git add "$base_name.pdf"
        done
      
    - name: Commit and push PDFs
      run: |
        git config --local user.email "actions@github.com"
        git config --local user.name "GitHub Actions"
        git commit -m "Update PDFs"
        git push